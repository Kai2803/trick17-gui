<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Application Loading...</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="m-5 bg-slate-800">
<div class="w-[800px] m-auto shadow-xl bg-white">
    <canvas id="canvas"></canvas>
</div>
<script type="module">
    let canvas = document.getElementById("canvas");
    let ctx = canvas.getContext("2d");

    let socket = new WebSocket('ws://localhost:8080/ws/');

    function processCommand(command) {
        let name = command.substring(0, 8);
        let args = command.substring(9);
        switch (name) {
            case 'setTitle':
                document.title = args;
                break;
            case 'setSize ':
                let parts = args.split(',');
                canvas.width = parts[0];
                canvas.height = parts[1];
                break;
            case 'clear   ':
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                break;
            case 'setColor':
                ctx.fillStyle = 'rgb(' + args + ')';
                ctx.strokeStyle = 'rgb(' + args + ')';
                break;
            case 'drawRect':
                ctx.strokeRect(...args.split(','));
                break;
            case 'fillRect':
                ctx.fillRect(...args.split(','));
                break;
            default:
                console.log('Unknown command: ' + command);
        }
    }

    socket.addEventListener('message', event => {
        event.data.split('\n').forEach(processCommand);
    });

    document.addEventListener('keydown', event => {
        socket.send('keyDown  ' + event.key);
    });
    document.addEventListener('keyup', event => {
        socket.send('keyUp    ' + event.key);
    });
    canvas.addEventListener('mousedown', event => {
        socket.send('mouseDwn ' + event.button);
    });
    canvas.addEventListener('mouseup', event => {
        socket.send('mouseUp  ' + event.button);
    });
    canvas.addEventListener('mousemove', event => {
        socket.send('mouseMov ' + event.offsetX + ',' + event.offsetY);
    });
</script>
</body>
</html>
